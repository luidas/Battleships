'use strict';

/*
 * collect data from stream.
 */
module.exports = function bodyParser(stream, callback) {
    const p = new Promise((resolve, reject) => {
        if (!stream) {
            throw new Error('stream is needed');
        }
        const chunks = [];
        let size = 0;
        stream.on('data', (chunk) => {
            chunks.push(chunk);
            size += chunk.length;
        });
        stream.on('end', () => {
            const buf = Buffer.concat(chunks, size);
            resolve(buf);
            if (typeof callback === 'function') callback(null, buf);
        });
        stream.on('error', (err) => {
            reject(err);
            if (typeof callback === 'function') callback(err);
        });
    });
    return typeof callback === 'function' ? null : p;
};
